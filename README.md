# Тестовое задание на курс "Разарботка Backend сервисов на Python"

REST сервис для получения информации о зарплате и дате следующего её повышения по логину и парою на курс "Разработка Backend сервисов на Python
Для накатывания миграций, если файла alembic.ini ещё нет, нужно запустить в темринале команду:

# Инструкция по установке и запуску
Первым делом необходимо клонировать репозиторий:
````
git clone https://gitlab.com/test9421118/cft_backend.git
````
Для последующей работы необзходимо установить docker. Скачать его можно на официальном сайте https://www.docker.com/products/docker-desktop

После установик докер, необходимо поднять контейнер

```
docker-compose -f docker-compose-ci.yaml up -d 
```
Затем необходимо провести миграции
```
alembic init migrations
```
````
alembic upgrade heads
````
Проверьте, запущены ли контейнеры через команду 
```
docker ps
```
Если вы видите, что запущено три контейнера то вы можете перейти по адресу для проверки работоспособности сервиса
```
http://localhost:8080/docs
```
- Для создания пользователя, измените данные в теле запроса. Обязательное укажите  зарплату больше 0. 
Создав пользователя 
- Вы сможете авторизоваться нажав на замочек во вкладке Get Current User Salary 
- Для авторизации введите логин и пароль созданного пользователя.

# Тестирование через Postman
Вы можете протестировать работу приложения через Postman, после запуска контйнера.
Для создания пользователя, выполните POST запрос по адресу 
````
http://localhost:8080/users/create_user
````
Тело запроса должно быть следующим
```
{
    "username": "user",
    "first_name": "Mikhail",
    "last_name": "Zubenko",
    "email": "test@gmail.com",
    "password": "76540123",
    "salary_amount": 1000
}
```
Для авторизации пользователя, выполните POST запрос по адресу  http://0.0.0.0:8080/login/token

В Body выберите тип x-www-form-urlencoded и введите следующие данные
```
username: string
password: string
```
В теле запроса вы получите access_token, который действует в течении 30 минут. Время действия можно задать через файл setting или .env

Чтобы получить данные о зарплате, выполните GET запрос по адресу http://0.0.0.0:8080/login/salary
- Скопируйте полученный токен. 
- Затем Выберите вкладку Authorization 
- В ней выберите Auth Type Bearer Token
- Вставьте токен в поле Token и нажмите Send
- В теле ответа будет информация о зарплате следующем повышении пользователя


Когда пользователь создан, вы можете авторизоваться
После этого будет создана папка с миграциями и конфиговский файл для alembic

# Тестирование через Pytest

В вашей IDE откройте папку tests и перейдите в файле test_handlers. Запустить его при помощи Pycharm

```
from myapp import mymodel
```

- Далее вводим: ```alembic revision --autogenerate -m "comment"```
- Создана миграция
- Дальше вводим ```alembic upgrade heads```

Для того чтобы во время тестов нормально генерировались миграции нужно"

- сначала попробовать запустить тесты обычным образом. с первого раза всё должно упасть
- если после падения в папке tests создались файлы alembic, то нужно прописать туда данные подключения к базе данных
- если файлы не создались, то нужно вручную создать папку migrations и в ней файл alembic.ini